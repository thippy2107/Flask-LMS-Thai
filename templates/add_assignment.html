{% extends "base.html" %}

{% block title %}เพิ่มงานมอบหมายใหม่{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <div class="max-w-xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-2xl border border-indigo-100">
        <h1 class="text-3xl font-bold text-indigo-700 mb-6 border-b pb-2">
            สร้างงานมอบหมายใหม่
        </h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-6 space-y-3">
                    {% for category, message in messages %}
                        <div class="p-4 rounded-lg shadow-md flash-{{ category|default('warning') }}" role="alert">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('add_assignment') }}">
            
            <!-- Class Selection -->
            <div class="mb-5">
                <label for="class_id" class="block text-sm font-medium text-gray-700 mb-2">เลือกชั้นเรียนที่ต้องการมอบหมาย <span class="text-red-500">*</span></label>
                <select id="class_id" name="class_id" required 
                        class="mt-1 block w-full py-3 px-4 border border-gray-300 bg-white rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-base">
                    <option value="" disabled selected>-- เลือกชั้นเรียน --</option>
                    {% for class in classes %}
                        <option value="{{ class.id }}">{{ class.name }} (รหัส: {{ class.join_code }})</option>
                    {% endfor %}
                </select>
                {% if not classes %}
                    <p class="text-sm text-red-500 mt-2">ยังไม่มีชั้นเรียน! กรุณาสร้างชั้นเรียนก่อนที่หน้าจัดการชั้นเรียน</p>
                {% endif %}
            </div>

            <!-- Title -->
            <div class="mb-5">
                <label for="title" class="block text-sm font-medium text-gray-700 mb-2">ชื่องานมอบหมาย <span class="text-red-500">*</span></label>
                <input type="text" id="title" name="title" required
                       class="mt-1 block w-full py-3 px-4 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-base"
                       placeholder="เช่น แบบฝึกหัดเรื่อง พีทาโกรัส">
            </div>

            <!-- File Link (New Field) -->
            <div class="mb-5">
                <label for="file_link" class="block text-sm font-medium text-gray-700 mb-2">ลิงก์ใบงาน / ไฟล์งาน (URL)</label>
                <input type="url" id="file_link" name="file_link" 
                       class="mt-1 block w-full py-3 px-4 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-base"
                       placeholder="เช่น https://docs.google.com/document/d/xyz">
                <p class="mt-2 text-xs text-gray-500">ใส่ลิงก์ไปยังไฟล์งานภายนอก (Google Docs, PDF, OneDrive ฯลฯ) (ไม่บังคับ)</p>
            </div>
            
            <!-- Description -->
            <div class="mb-5">
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">คำอธิบายงาน</label>
                <textarea id="description" name="description" rows="3"
                          class="mt-1 block w-full py-3 px-4 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-base"
                          placeholder="รายละเอียด, ข้อกำหนดในการส่งงาน..."></textarea>
            </div>

            <!-- Max Score and Due Date Group -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-6">
                
                <!-- Max Score -->
                <div>
                    <label for="max_score" class="block text-sm font-medium text-gray-700 mb-2">คะแนนเต็ม <span class="text-red-500">*</span></label>
                    <input type="number" id="max_score" name="max_score" required min="1" value="100"
                           class="mt-1 block w-full py-3 px-4 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-base text-center">
                </div>

                <!-- Due Date -->
                <div>
                    <label for="due_date" class="block text-sm font-medium text-gray-700 mb-2">กำหนดส่ง (วัน-เวลา)</label>
                    <input type="datetime-local" id="due_date" name="due_date"
                           class="mt-1 block w-full py-3 px-4 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-base">
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end space-x-3 pt-4 border-t">
                <a href="{{ url_for('teacher_dashboard') }}" class="py-3 px-6 border border-gray-300 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition duration-150">
                    ยกเลิก
                </a>
                <button type="submit"
                        class="py-3 px-6 border border-transparent rounded-xl shadow-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 
                               focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                    มอบหมายงาน
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
